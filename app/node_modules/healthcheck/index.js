'use strict';

var
  express = require('express'),
  app = express(),
  logger = require('bunyan-request-logger'),
  noCache = require('connect-cache-control'),
  version = require('version-healthcheck');

var log = logger();

// Expose the logger so that requiring modules can
// use it.
app.log = log;

// Automatically log all incoming requests with
// response data and request ids.
app.use(log.requestLogger());

// Version healthcheck route
//
// Responds with app name and version from
// package.json, and latest git build hash.
//
// Useful for monitoring the health status of
// your application deployments.
app.get('/version', noCache, version);

module.exports = app;
